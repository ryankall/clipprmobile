## Workflow 1: Public Client Booking Request

**Trigger**: Client visits public booking link (e.g., book.clippr.com/6467891820-jaythebarber)

### Steps:
1. **Client selects services and time**
   - Client browses available services
   - Client selects date and time from available slots
   - Client fills out contact information
2. **Time slot temporarily locked**
  - System soft-locks slot for 30 minutes on client booking request page
  - Slot marked as ‚Äúheld‚Äù to prevent duplicate requests
  
2. **Booking request creation**
   - System creates a message in barber's inbox
   - Message contains: client name, phone, email, requested services, date/time, notes
   - Message type: "booking_request"

3. **Barber notification**
   - Message appears in barber's messages page
   - Unread count increases
   - Barber can view details and choose to book or decline

### Current Status: ‚úÖ Implemented
- Public booking pages working
- Message creation working
- Barber can view booking requests

---

## Workflow 2: Barber Books Appointment from Message

**Trigger**: Barber clicks "Book Appointment" button on a booking request message

### Steps:
1. **Client lookup/creation**
   - System checks if client exists by phone number
   - If client doesn't exist: creates new client record
   - If client exists: updates address and email if provided

2. **Schedule appointment modal**
   - Pre-fills appointment form with message data
   - Client name, phone, email auto-populated
   - Services, date, time pre-selected
   - Address and notes pre-filled

3. **Appointment creation** (Modified workflow needed)
   - Creates appointment with "pending" status
   - Slot is locked
   - Shows in ‚ÄúPending Confirmations‚Äù
   - Auto-expiry timer started (30 min)

4. SMS sent to client for confirmation

### Current Status: ‚úÖ Partially implemented (needs SMS confirmation)
- Client lookup/creation working
- Modal pre-filling working
- Need to modify to create pending appointments with SMS confirmation

---

## Workflow 3: Direct Barber Appointment Creation

**Trigger**: Barber goes to calendar and manually creates appointment

### Steps:
1. **Manual appointment creation**
   - Barber navigates to calendar page
   - Clicks "Book Appointment" button
   - Manually fills out all details (client, services, time, etc.)
   - System checks for conflicts (pending/confirmed)

2. **Appointment creation** (Modified workflow needed)
   - Creates appointment with "pending" status
   - Auto-expires if no reply in 30 mins 
   - Sends SMS confirmation request to client

### Current Status: ‚úÖ Partially implemented (needs SMS confirmation)
- Manual creation form working
- Need to modify to create pending appointments with SMS confirmation

---

## Workflow 4: SMS Confirmation System (To Be Implemented)

**Trigger**: Appointment created (from message booking or manual creation)

### Steps:
1. **SMS sent to client**
   - Message: "Hi [Name]! Your appointment for [Service] on [Date] at [Time] is pending. Reply YES to confirm or NO to cancel."
   - 30-minute expiration timer starts
   - Appointment status: "pending"

2. **Client confirms (YES)**
   - Appointment status changes to "confirmed"
   - Moves from "Pending Reservations" to "Current/Next" cards
   - Bell notification for barber
   - Message sent to barber: "[Client] confirmed their appointment"
   - SMS to client: ‚ÄúYou're confirmed! See you at [Appointment Time].‚Äù

3. **Client cancels (NO)**
   - Appointment deleted from system
   - Bell notification for barber
   - Message sent to barber: "[Client] cancelled their appointment"
   - SMS to client : ‚ÄúYour appointment has been canceled. You‚Äôre welcome to rebook any time!‚Äù

4. **Timeout (30 minutes no response)**
   - Appointment automatically deleted
   - Bell notification for barber
   - Slot becomes available
   - Message sent to barber: "[Client] appointment expired (no response)"

### Current Status: üîÑ To be implemented

---

## Workflow 5: Client SMS Cancellation (To Be Implemented)

**Trigger**: Client sends "CANCEL" via SMS (for any confirmed appointment)

### Steps:
1. **SMS processing**
   - System receives "CANCEL" SMS from client
   - Looks up client's active appointments by phone number

2. **Appointment cancellation**
   - Deletes appointment from calendar
   - Bell notification for barber
   - Message sent to barber: "[Client] cancelled their [Service] appointment on [Date]"

3. **Confirmation to client**
   - SMS reply: "Your appointment has been cancelled. Thanks, and feel free to rebook!‚Äù

### Current Status: üîÑ To be implemented

---

## Workflow 6: Appointment Status Management (‚úÖ Implemented)

**Current Implementation**: Comprehensive status-based appointment system

### Appointment Statuses:
Status	Meaning	Affects availability
pending	Awaiting client confirmation	‚úÖ Blocks time slot
confirmed	Client confirmed	‚úÖ Blocks time slot
cancelled	Client or barber cancelled	‚ùå Frees slot
expired	No confirmation within hold window	‚ùå Frees slot
no_show	Client missed without canceling	‚ùå Frees slot (logged)

### Dashboard Behavior:
1. **Current/Next appointment cards**: Only show appointments with "confirmed" status
2. **Pending confirmations card**: Shows only appointments with "pending" status  
3. **Cancelled appointments**: Do not appear in any dashboard cards

### Calendar Behavior:
1. **All appointments visible**: Shows pending, confirmed, cancelled, and no show appointments
2. **Visual distinction**: Different styling for different statuses
3. **Deletion allowed**: Cancelled appointments can be safely deleted

### Overlap Detection:
1. **Ignores cancelled appointments**: Cancelled appointments don't block new bookings
2. **Considers pending and confirmed**: Both pending and confirmed appointments prevent overlaps
3. **Detailed conflict reporting**: Shows specific conflicting appointments with times




Expired, cancelled, no_show should not affect scheduling new appointment.
Status	Should Auto-Delete?	Why / When
expired	‚úÖ Yes (after short delay)	No confirmation received ‚Äî delete after 1‚Äì2 hours to clean up
cancelled	‚úÖ Yes (after short delay)	Intentional cancellation ‚Äî safe to remove after 1‚Äì2 hours
no_show	‚ùå No (keep, archive or tag)	Still useful for history, reports, client flags

‚úÖ Recommended Auto-Cleanup Rules
üîÑ expired
Auto-delete after 1 hour

Prevents clutter in calendar or dashboard

Frees up the slot quickly


if (appointment.status === "expired" && createdAt < now - 1 hour) {
  deleteAppointment();
}

‚ùå cancelled
Auto-delete after 1‚Äì2 hours (optional delay in case of reschedules)

Prevents confusion on calendar

Can trigger notification to barber before deletion

üîÅ no_show
Keep in database, but:

Hide from main calendar/dashboard

Tag in client profile

Optionally show in "Appointment History" or "Missed Appointments"



